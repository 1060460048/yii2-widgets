/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2013
 * @package yii2-widgets
 * @version 1.0.0
 *
 * File input styled for Twitter Bootstrap 3.0 that utilizes HTML5 File Input's
 * advanced features. This plugin is inspired by the blog article at
 * http://www.abeautifulsite.net/blog/2013/08/whipping-file-inputs-into-shape-with-bootstrap-3/
 * and Jasny's File Input plugin http://jasny.github.io/bootstrap/javascript/#fileinput
 *
 * Built for Yii Framework 2.0. But this is useful for various scenarios.
 * Author: Kartik Visweswaran
 * Copyright: 2013, Kartik Visweswaran, Krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */(function(e){var t=function(t,n){return t===null||t===undefined||t==[]||t===""||n&&e.trim(t)===""};var n=function(e,n,r){return t(e)||t(e[n])?r:e[n]};var r=function(e,t){return typeof e!=="undefined"?e.match("image.*"):t.match(/\.(gif|png|jpe?g)$/i)};var i=function(e,t){return typeof e!=="undefined"?e.match("text.*"):t.match(/\.(txt|md|csv|htm|html|php|ini)$/i)};var s=function(t,r){this.$element=e(t);this.$input=n(r,"elInput",this.$element.find(":file"));this.$caption=n(r,"elCaptionText",this.$element.find(".file-caption-name"));this.$previewContainer=n(r,"elPreviewContainer",this.$element.find(".file-preview"));this.$preview=n(r,"elPreviewImage",this.$element.find(".file-preview-thumbnails"));this.$previewStatus=n(r,"elPreviewStatus",this.$element.find(".file-preview-status"));this.$msgLoading=n(r,"msgLoading","Loading &hellip;");this.$msgProgress=n(r,"msgProgress","Loaded {percent}% of {file}");this.$msgSelected=n(r,"msgSelected","{n} files selected");this.$previewFileType=n(r,"previewFileType","image");this.$wrapTextLength=n(r,"wrapTextLength",250);this.$wrapIndicator=n(r,"wrapIndicator",' <span class="wrap-indicator" title="{title}">[&hellip;]</span>');if(this.$input.length===0){return}this.$name=this.$input.attr("name")||r.name;this.$hidden=this.$element.find('input[type=hidden][name="'+this.$name+'"]');this.$isIE==(window.navigator.appName=="Microsoft Internet Explorer");if(this.$hidden.length===0){this.$hidden=e('<input type="hidden" />');this.$element.prepend(this.$hidden)}this.original={preview:this.$preview.html(),hiddenVal:this.$hidden.val()};this.listen()};s.prototype={constructor:s,listen:function(){this.$input.on("change",e.proxy(this.change,this));e(this.$input[0].form).on("reset",e.proxy(this.reset,this));this.$element.find(".fileinput-remove").on("click",e.proxy(this.clear,this))},trigger:function(e){this.$input.trigger("click");e.preventDefault()},clear:function(e){if(e){e.preventDefault()}this.$hidden.val("");this.$hidden.attr("name",this.name);this.$input.attr("name","");if(this.$isIE){var t=this.$input.clone(true);this.$input.after(t);this.$input.remove();this.$input=t}else{this.$input.val("")}if(e!==false){this.$input.trigger("change");this.$element.trigger("fileclear")}this.$preview.html("");this.$caption.html("");this.$element.removeClass("file-input-new").addClass("file-input-new")},reset:function(e){this.clear(false);this.$hidden.val(this.original.hiddenVal);this.$preview.html(this.original.preview);this.$element.find(".fileinput-filename").text("");this.$element.trigger("filereset")},change:function(e){var t=this.$input,n=t.get(0).files,s=n?n.length:1,o=t.val().replace(/\\/g,"/").replace(/.*\//,""),u=this.$preview,f=this.$previewContainer,l=this.$previewStatus,h=this.$msgLoading,p=this.$msgProgress,d=this.$msgSelected,v,m=this.$previewFileType,g=parseInt(this.$wrapTextLength),y=this.$wrapIndicator;if(e.target.files===undefined){v=e.target&&e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]}else{v=e.target.files}if(v.length===0){return}u.html("");var b=v.length;for(var w=0;w<b;w++){(function(e){var t=e.name;var n=r(e.type,e.name);var s=i(e.type,e.name);if(u.length>0&&(m=="any"?n||s:m=="text"?s:n)&&typeof FileReader!=="undefined"){var o=new FileReader;l.html(h);f.addClass("loading");o.onload=function(e){var n="";if(s){var r=e.target.result;if(r.length>g){y=y.replace("{title}",r);r=r.substring(0,g-1)+y}n='<div class="file-preview-frame"><div class="file-preview-text" title="'+t+'">'+r+"</div></div>"}else{n='<div class="file-preview-frame"><img src="'+e.target.result+'" class="file-preview-image" title="'+t+'" alt="'+t+'"></div>'}u.append("\n"+n);if(w>=b-1){f.removeClass("loading");l.html("")}};o.onprogress=function(t){if(t.lengthComputable){var n=parseInt(t.loaded/t.total*100,10);var r=p.replace("{percent}",n).replace("{file}",e.name);l.html(r)}};if(s){o.readAsText(e)}else{o.readAsDataURL(e)}}else{u.append('\n<div class="file-preview-frame"><div class="file-preview-other"><h2><i class="glyphicon glyphicon-file"></i></h2>'+t+"</div></div>")}})(v[w])}var E=s>1?d.replace("{n}",s):o;this.$caption.html(E);this.$element.removeClass("file-input-new");t.trigger("fileselect",[s,o])}};e.fn.fileinput=function(t){return this.each(function(){var n=e(this),r=n.data("fileinput");if(!r){n.data("fileinput",r=new s(this,t))}if(typeof t=="string"){r[t]()}})}})(window.jQuery)