/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2013
 * @package yii2-widgets
 * @version 1.0.0
 *
 * File input styled for Twitter Bootstrap 3.0 that utilizes HTML5 File Input's
 * advanced features. This plugin is inspired by the blog article at
 * http://www.abeautifulsite.net/blog/2013/08/whipping-file-inputs-into-shape-with-bootstrap-3/
 * and Jasny's File Input plugin http://jasny.github.io/bootstrap/javascript/#fileinput
 *
 * Built for Yii Framework 2.0. But this is useful for various scenarios.
 * Author: Kartik Visweswaran
 * Copyright: 2013, Kartik Visweswaran, Krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(e){var f=function(h,g){return h===null||h===undefined||h==[]||h===""||g&&e.trim(h)===""};var b=function(g,i,h){return(f(g)||f(g[i]))?h:g[i]};var a=function(h,g){return(typeof h!=="undefined")?h.match("image.*"):g.match(/\.(gif|png|jpe?g)$/i)};var c=function(h,g){return(typeof h!=="undefined")?h.match("text.*"):g.match(/\.(txt|md|csv|htm|html|php|ini)$/i)};var d=function(h,g){this.$element=e(h);this.$input=b(g,"elInput",this.$element.find(":file"));this.$caption=b(g,"elCaptionText",this.$element.find(".file-caption-name"));this.$previewContainer=b(g,"elPreviewContainer",this.$element.find(".file-preview"));this.$preview=b(g,"elPreviewImage",this.$element.find(".file-preview-thumbnails"));this.$previewStatus=b(g,"elPreviewStatus",this.$element.find(".file-preview-status"));this.$msgLoading=b(g,"msgLoading","Loading &hellip;");this.$msgProgress=b(g,"msgProgress","Loaded {percent}% of {file}");this.$msgSelected=b(g,"msgSelected","{n} files selected");this.$previewFileType=b(g,"previewFileType","image");this.$wrapTextLength=b(g,"wrapTextLength",250);this.$wrapIndicator=b(g,"wrapIndicator",' <span class="wrap-indicator" title="{title}">[&hellip;]</span>');if(this.$input.length===0){return}this.$name=this.$input.attr("name")||g.name;this.$hidden=this.$element.find('input[type=hidden][name="'+this.$name+'"]');this.$isIE==(window.navigator.appName=="Microsoft Internet Explorer");if(this.$hidden.length===0){this.$hidden=e('<input type="hidden" />');this.$element.prepend(this.$hidden)}this.original={preview:this.$preview.html(),hiddenVal:this.$hidden.val()};this.listen()};d.prototype={constructor:d,listen:function(){this.$input.on("change",e.proxy(this.change,this));e(this.$input[0].form).on("reset",e.proxy(this.reset,this));this.$element.find(".fileinput-remove").on("click",e.proxy(this.clear,this))},trigger:function(g){this.$input.trigger("click");g.preventDefault()},clear:function(h){if(h){h.preventDefault()}this.$hidden.val("");this.$hidden.attr("name",this.name);this.$input.attr("name","");if(this.$isIE){var g=this.$input.clone(true);this.$input.after(g);this.$input.remove();this.$input=g}else{this.$input.val("")}if(h!==false){this.$input.trigger("change");this.$element.trigger("fileclear")}this.$preview.html("");this.$caption.html("");this.$element.removeClass("file-input-new").addClass("file-input-new")},reset:function(g){this.clear(false);this.$hidden.val(this.original.hiddenVal);this.$preview.html(this.original.preview);this.$element.find(".fileinput-filename").text("");this.$element.trigger("filereset")},change:function(w){var x=this.$input,m=x.get(0).files,l=m?m.length:1,o=x.val().replace(/\\/g,"/").replace(/.*\//,""),s=this.$preview,r=this.$previewContainer,t=this.$previewStatus,j=this.$msgLoading,v=this.$msgProgress,k=this.$msgSelected,q,h=this.$previewFileType,p=parseInt(this.$wrapTextLength),g=this.$wrapIndicator;if(w.target.files===undefined){q=w.target&&w.target.value?[{name:w.target.value.replace(/^.+\\/,"")}]:[]}else{q=w.target.files}if(q.length===0){return}s.html("");var y=q.length;for(var u=0;u<y;u++){(function(A){var z=A.name;var C=a(A.type,A.name);var B=c(A.type,A.name);if(s.length>0&&(h=="any"?(C||B):(h=="text"?B:C))&&typeof FileReader!=="undefined"){var i=new FileReader();t.html(j);r.addClass("loading");i.onload=function(F){var E="";if(B){var D=F.target.result;if(D.length>p){g=g.replace("{title}",D);D=D.substring(0,(p-1))+g}E='<div class="file-preview-frame"><div class="file-preview-text" title="'+z+'">'+D+"</div></div>"}else{E='<div class="file-preview-frame"><img src="'+F.target.result+'" class="file-preview-image" title="'+z+'" alt="'+z+'"></div>'}s.append("\n"+E);if(u>=y-1){r.removeClass("loading");t.html("")}};i.onprogress=function(E){if(E.lengthComputable){var D=parseInt(((E.loaded/E.total)*100),10);var F=v.replace("{percent}",D).replace("{file}",A.name);t.html(F)}};if(B){i.readAsText(A)}else{i.readAsDataURL(A)}}else{s.append('\n<div class="file-preview-frame"><div class="file-preview-other"><h2><i class="glyphicon glyphicon-file"></i></h2>'+z+"</div></div>")}})(q[u])}var n=l>1?k.replace("{n}",l):o;this.$caption.html(n);this.$element.removeClass("file-input-new");x.trigger("fileselect",[l,o])}};e.fn.fileinput=function(g){return this.each(function(){var i=e(this),h=i.data("fileinput");if(!h){i.data("fileinput",(h=new d(this,g)))}if(typeof g=="string"){h[g]()}})}})(window.jQuery);